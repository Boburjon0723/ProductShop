<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Do'kon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../style/style.css">
</head>

<body>
    <header>
        <div class="logo">
            <i class="fas fa-shopping-bag"></i>
            <span>TechShop</span>
        </div>

        <button class="hamburger" id="hamburger">
            <i class="fas fa-bars"></i>
        </button>

        <nav class="logo1" id="navbar">
            <ul>
                <li><a href=""><i class="fas fa-home"></i> Bosh sahifa</a></li>
                <li><a href="./about.html"><i class="fas fa-info-circle"></i> Biz haqimizda</a></li>
                <li><a href="./services.html"><i class="fas fa-concierge-bell"></i> Xizmatlar</a></li>
                <li><a href="./contact.html"><i class="fas fa-phone"></i> Aloqa</a></li>
            </ul>
        </nav>

        <div class="akkaunt">
            <button><i class="fas fa-shopping-cart"></i> Savat</button>
            <button><a href="./login_register_page.html"></a><i class="fas fa-user"></i> Kirish</a></button>
        </div>
    </header>

    <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="2"></button>
        </div>

        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=1200" alt="Smartphones">
                <div class="carousel-caption">
                    <h2>Eng yangi smartfonlar</h2>
                    <p>Ajoyib narxlar va yuqori sifat</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="https://images.unsplash.com/photo-1546868871-7041f2a55e12?w=1200" alt="Smartwatch">
                <div class="carousel-caption">
                    <h2>Smart soatlar</h2>
                    <p>Hayotingizni osonlashtiring</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=1200" alt="Headphones">
                <div class="carousel-caption">
                    <h2>Premium audio</h2>
                    <p>Mukammal tovush tajribasi</p>
                </div>
            </div>
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <div class="container-wrapper">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Mahsulotlarni qidiring...">
            <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
        </div>

        <div class="categories">
            <button class="active" data-category="all" onclick="filterByCategory('all')">
                <i class="fas fa-th"></i> Hammasi
            </button>
            <button data-category="samsung" onclick="filterByCategory('samsung')">
                <i class="fas fa-mobile-alt"></i> Samsung
            </button>
            <button data-category="apple" onclick="filterByCategory('apple')">
                <i class="fab fa-apple"></i> Apple
            </button>
            <button data-category="xiaomi" onclick="filterByCategory('xiaomi')">
                <i class="fas fa-mobile"></i> Xiaomi
            </button>
        </div>

        <div id="loadingProducts" class="loading">
            <i class="fas fa-spinner"></i>
            <p>Mahsulotlar yuklanmoqda...</p>
        </div>

        <div class="products-grid" id="productsGrid" style="display: none;"></div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <img id="modalImage" class="modal-image" src="" alt="">
            <div class="modal-body">
                <h2 id="modalTitle"></h2>
                <div class="price" id="modalPrice"></div>
                <p class="description" id="modalDescription"></p>

                <h4 style="margin-bottom: 15px;">Buyurtma berish</h4>
                <div class="order-form">
                    <input type="text" id="userName" placeholder="Ismingiz" required>
                    <input type="tel" id="userPhone" placeholder="Telefon raqamingiz" required>
                    <button onclick="sendOrder()">
                        <i class="fas fa-paper-plane"></i> Buyurtma berish
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Hujjatlar</h3>
                <ul>
                    <li><a href="#">Sotish shartlari</a></li>
                    <li><a href="#">Nizom</a></li>
                    <li><a href="#">Maxfiylik siyosati</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Xizmatlar</h3>
                <ul>
                    <li><a href="#">Muddatli to'lov</a></li>
                    <li><a href="#">Yetkazib berish</a></li>
                    <li><a href="#">Qaytarish siyosati</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Katalog</h3>
                <ul>
                    <li><a href="#">Smartfonlar</a></li>
                    <li><a href="#">Noutbuklar</a></li>
                    <li><a href="#">Aksessuarlar</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Ijtimoiy tarmoqlar</h3>
                <div class="social-links">
                    <a href="https://t.me/Boburjon3601" target="_blank"><i class="fab fa-telegram"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <div class="telegram-float">
        <a href="https://t.me/Boburjon3601" target="_blank">
            <i class="fab fa-telegram-plane"></i>
        </a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBCiv22Z0SKWKba0r0_J3Sc_naAA_c1vcg",
            authDomain: "messenger-ali.firebaseapp.com",
            databaseURL: "https://messenger-ali-default-rtdb.firebaseio.com",
            projectId: "messenger-ali",
            storageBucket: "messenger-ali.firebasestorage.app",
            messagingSenderId: "596917405424",
            appId: "1:596917405424:web:c7604f94414a043d02e435"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let allProducts = [];
        let currentProduct = null;

        function loadProducts() {
            const productsRef = ref(database, 'products');

            onValue(productsRef, (snapshot) => {
                const loading = document.getElementById('loadingProducts');
                const grid = document.getElementById('productsGrid');

                loading.style.display = 'none';
                grid.style.display = 'grid';

                allProducts = [];
                snapshot.forEach((childSnapshot) => {
                    allProducts.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });

                displayProducts(allProducts);
            });
        }

        function displayProducts(products) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            if (products.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 40px;">Mahsulotlar topilmadi</p>';
                return;
            }

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.onclick = () => openModal(product);
                card.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <div class="product-info">
                        <h3>${product.name}</h3>
                        <div class="price">$${product.price}</div>
                        <span class="category">${product.category}</span>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        window.filterByCategory = function(category) {
            const buttons = document.querySelectorAll('.categories button');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.closest('button').classList.add('active');

            if (category === 'all') {
                displayProducts(allProducts);
            } else {
                const filtered = allProducts.filter(p => p.category === category);
                displayProducts(filtered);
            }
        };

        window.searchProducts = function() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allProducts.filter(p =>
                p.name.toLowerCase().includes(query) ||
                p.description?.toLowerCase().includes(query)
            );
            displayProducts(filtered);
        };

        document.getElementById('searchInput').addEventListener('keyup', (e) => {
            if (e.key === 'Enter') searchProducts();
        });

        window.openModal = function(product) {
            currentProduct = product;
            document.getElementById('modalImage').src = product.image;
            document.getElementById('modalTitle').textContent = product.name;
            document.getElementById('modalPrice').textContent = `$${product.price}`;
            document.getElementById('modalDescription').textContent = product.description || 'Mahsulot haqida ma\'lumot mavjud emas';
            document.getElementById('productModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        };

        window.closeModal = function() {
            document.getElementById('productModal').classList.remove('show');
            document.body.style.overflow = 'auto';
            document.getElementById('userName').value = '';
            document.getElementById('userPhone').value = '';
        };

        window.sendOrder = async function() {
            const name = document.getElementById('userName').value;
            const phone = document.getElementById('userPhone').value;

            if (!name || !phone) {
                alert('Iltimos, barcha maydonlarni to\'ldiring!');
                return;
            }

            const BOT_TOKEN = '8361286034:AAGhhavjiXhqDKoOxIcN1WcOx5TfUU_pSH4';
            const CHAT_ID = '5655390425';

            const message = `ðŸ›ï¸ YANGI BUYURTMA!

ðŸ‘¤ Ism: ${name}
ðŸ“ž Telefon: ${phone}
ðŸ“¦ Mahsulot: ${currentProduct.name}
ðŸ’° Narx: $${currentProduct.price}
ðŸ·ï¸ Kategoriya: ${currentProduct.category}`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message
                    })
                });

                if (response.ok) {
                    alert('âœ… Buyurtma muvaffaqiyatli yuborildi! Tez orada siz bilan bog\'lanamiz.');
                    closeModal();
                } else {
                    alert('âŒ Xatolik yuz berdi. Iltimos, qaytadan urinib ko\'ring.');
                }
            } catch (error) {
                alert('âŒ Tarmoq xatosi: ' + error.message);
            }
        };

        document.getElementById('hamburger').addEventListener('click', () => {
            document.getElementById('navbar').classList.toggle('active');
        });

        document.getElementById('productModal').addEventListener('click', (e) => {
            if (e.target.id === 'productModal') closeModal();
        });

        loadProducts();
    </script>
<script src="./server.js/script.js"></script>    
</body>
</html>